# ScriptWeaver - Task Log

## 📋 완료된 작업 요약

### Phase 1: 기본 시스템 구축 + 컨텐츠-키 분리 아키텍처 ✅

-   React + Vite + TypeScript, Tailwind CSS 4.x, React Flow, Zustand 기반 웹 에디터 구축
-   노드 생성/편집/연결 시스템, 텍스트-키 분리 아키텍처, 자동 키 생성, JSON/CSV 데이터 관리

### Phase 2: 사용성 개선 ✅

#### 핵심 개선사항

-   **UX-01 중복 텍스트 처리**: 모달 → 토스트 메시지, 전역 관리
-   **노드 배치 개선**: Y축 세로 → X축 가로 배치, 성능 최적화 (100개 노드 제한)
-   **자동 정렬 기능**: 선택된 노드 기준 자식 정렬, 전체 트리 정렬 기능
-   **레이아웃 엔진 시스템**: 3단계 파이프라인, 앵커 오프셋, 순환 참조 감지 (dagre 기반)
-   **전역 단축키 시스템**: 전문 편집 도구 수준의 키보드 워크플로우
-   **UI 간소화**: 좌측 패널 70% 공간 절약, 핵심 기능 중심 재구성

#### 노드 배치 및 정렬 시스템 개선

-   **핸들 클릭 노드 생성 위치 개선**: 부모 노드 우측 50px 간격, 중앙 정렬
-   **레이아웃 엔진 시스템 구축**: `layoutEngine.ts` 완전한 레이아웃 시스템 (463줄)
-   **다중 선택 및 조작**: Ctrl+Click, 드래그 선택, 일괄 삭제/이동
-   **핸들 클릭으로 후속 노드 생성**, **화자 자동 입력 기능**
-   **노드 생성 로직 리팩터링**: 중복 코드 제거, 일관된 기본값 적용
-   **선택지 노드 기본 구조 개선**: 생성 시 빈 선택지 2개 자동 제공
-   **Undo/Redo 시스템 확장**: LocalizationStore 포함, 비동기 작업 관리자, 상태 충돌 방지
-   **노드 복사/붙여넣기 고도화**: 다중 노드 복사 시 내부 연결 관계 유지
-   **노드 삭제 시 키 정리**: 삭제된 노드의 LocalizationStore 키 자동 제거
-   **skipHistory 매개변수 → 옵션 객체 패턴 개선**: 매개변수 확장성 확보
-   **IEditorStore 인터페이스 정리**: 불필요한 선언 및 구현부 제거
-   **키 정리 로직 중복 제거 및 공통화**: `src/utils/keyCleanup.ts` 분리
-   **다중 그래프 정렬 개선**: 독립적인 여러 그래프 존재 시 모든 그래프를 통합 정렬
-   **기존 정렬 시스템 정리**: 호환성 목적 기존 정렬 UI 및 로직 제거

#### 핵심 편집 기능 개선

-   **노드 타입 변환 기능**: PropertyPanel에서 TextNode ↔ ChoiceNode 변환
    -   구현 완료: PropertyPanel에 노드 타입 드롭다운 추가, 직접 변환 방식 구현
    -   변환 로직: TextNode → ChoiceNode, ChoiceNode → TextNode 완벽 구현
    -   보존 정보: speakerText, contentText, speed, 로컬라이제이션 키 참조 완벽 유지

#### 데이터 관리 및 기타 개선

-   **localStorage 관리 도구**: 저장 공간 사용량 표시, 수동 정리 기능
    -   구현 방향: 좌측 도구 상자에 아코디언 메뉴로 추가
    -   UI 구성: 아코디언 헤더에 전체 localStorage 사용량 표시, 펼침 시 카테고리별 용량 상세 표시
    -   기능: 히스토리 정리, 미사용 키 정리, 전체 초기화
    -   **히스토리 정리 오작동 해결**: localStorage와 메모리 상태 동시 업데이트로 해결

#### UI/UX 세부 개선

-   **삭제 확인 다이얼로그 제거**: Undo 기능으로 confirm 없이 즉시 삭제, 토스트 알림 추가
-   **토스트 메시지 위치 변경**: 중앙 하단 → 중앙 상단으로 이동, 하단 상태창과 겹침 방지
-   **노드 ID 미리보기 제거**: 기획자 친화적 UI로 ID 숨김 처리
-   **노드 텍스트 줄바꿈 표시 개선**: 대화 내용/질문에서 줄바꿈 보존, 선택지는 한 줄 유지
-   **엣지 제목 숨김**: 연결선 레이블 시각적 정리, 선택지 연결선 제목 제거
-   **모달 딤 조절 기능**: 배경 어둡기 사용자 설정
    -   구현 완료: Tailwind CSS 3.0+ 문법 `bg-black/30` 적용으로 반투명 딤 효과 구현
    -   개선 효과: 완전한 검은색 → 30% 투명도로 더 자연스러운 모달 UX
-   **상단바 ScriptWeaver 로고 및 타이틀 고정** (계획 외 UI 개선)
    -   구현 완료: icon.svg를 메인 로고로 상단바에 배치, 타이틀을 ScriptWeaver(띄어쓰기 없이)로 고정
    -   개선 효과: 브랜드 일관성 강화, 메인 로고와 타이틀의 시각적 통일성 확보

### 2025/06/23 개선
- (2025/06/23 21:52) 노드 우측 핸들로 자식 노드 생성 시 부모 노드의 화자(speakerText, speakerKeyRef) 정보를 자식 노드에 자동 복사하도록 개선 (방향 A) — 대화 흐름 작성 편의성 향상
- (2025/06/23 22:07) 선택지 노드 생성 시 기본 선택지 텍스트를 비워두도록 개선 및 중복 코드 통합 (방향 A) — 선택지 생성 시 "선택지 1", "선택지 2" 텍스트 제거, 3곳 중복 구현을 coreServices의 공통 함수로 통합
- (2025/06/23 22:21) 우측 PropertyPanel 너비 드래그 조절 기능 개발 — CSS resize + 커스텀 핸들러로 320~640px 범위에서 너비 조절, 패널 왼쪽 경계 호버 시 커서 변경
- (2025/06/23 22:32) 단축키 및 더블클릭 기능 개선 — Ctrl+Delete로 선택 노드와 후손 노드 일괄 삭제, 노드 더블클릭으로 후손 자동 정렬 기능 구현
  
