# 테스트 케이스: 핸들 클릭 노드 생성 위치 개선 ✅ **완료**

## 📋 테스트 범위
- **기능**: 핸들 클릭으로 새 노드 생성 시 정확한 위치에 배치
- **상태**: ✅ **2025-06-14 완료** - 레이아웃 엔진 시스템에 통합됨
- **대상 함수**: `calculateChildNodePosition()`, `createAndConnectChoiceNode()`, `createAndConnectTextNode()`
- **구현된 요구사항**: 
  - 실제 DOM 크기 측정 기반 정확한 위치 계산
  - 부모 노드 우측 50px 간격 (30px → 50px로 변경)
  - 중앙 정렬 배치 (Y축 드리프트 방지)
  - TextNode/ChoiceNode 통일된 로직

---

## TC-POS-001: TextNode 핸들 클릭 - 단일 자식 생성

### 전제 조건
- Canvas에 TextNode 1개 존재 (위치: x=100, y=100, 크기: 200x120)
- 해당 TextNode에 연결된 자식 노드 없음

### 테스트 단계
1. TextNode의 우측 핸들 클릭
2. 새 텍스트 노드 생성 확인

### 예상 결과
- **새 노드 X 위치**: 100 + 200 + 50 = 350 (간격 50px로 변경)
- **새 노드 Y 위치**: 100 + (120/2) - (120/2) = 100 (부모 중앙과 동일)
- **연결 상태**: 부모 → 자식 연결선 생성

### 실제 결과
- ✅ **완료** - 실제 DOM 크기 측정 + 50px 간격 + 중앙 정렬 구현

---

## TC-POS-002: ChoiceNode 핸들 클릭 - 첫 번째 자식 생성

### 전제 조건
- Canvas에 ChoiceNode 1개 존재 (위치: x=100, y=100, 크기: 200x150)
- 선택지 2개 보유, 연결된 자식 노드 없음

### 테스트 단계
1. 첫 번째 선택지의 핸들 클릭
2. 새 텍스트 노드 생성 확인

### 예상 결과
- **새 노드 X 위치**: 100 + 200 + 50 = 350 (간격 50px로 변경)
- **새 노드 Y 위치**: 100 + (150/2) - (120/2) = 115 (부모 중앙 기준)
- **연결 상태**: 첫 번째 선택지 → 새 노드 연결

### 실제 결과
- ✅ **완료** - ChoiceNode 중앙 정렬 개선 포함

---

## TC-POS-003: ChoiceNode 핸들 클릭 - 두 번째 자식 생성 (기존 자식 있음)

### 전제 조건
- Canvas에 ChoiceNode 1개 존재 (위치: x=100, y=100)
- 첫 번째 선택지에 이미 자식 노드 연결됨 (위치: x=330, y=115)
- 두 번째 선택지에 자식 노드 없음

### 테스트 단계
1. 두 번째 선택지의 핸들 클릭
2. 새 텍스트 노드 생성 확인

### 예상 결과
- **새 노드 X 위치**: 330 (기존 자식과 동일)
- **새 노드 Y 위치**: 115 + 120 + 30 = 265 (기존 자식 아래 30px 간격)
- **연결 상태**: 두 번째 선택지 → 새 노드 연결

### 실제 결과
- [ ] 통과 / [ ] 실패
- 실제 위치: X=___, Y=___
- 비고: ___________

---

## TC-POS-004: 노드 크기 변화 대응 테스트

### 전제 조건
- Canvas에 내용이 긴 TextNode 존재 (실제 DOM 크기: 250x140)
- 노드에 연결된 자식 없음

### 테스트 단계
1. 해당 노드의 우측 핸들 클릭
2. DOM에서 실제 노드 크기 측정
3. 새 노드 위치 계산 확인

### 예상 결과
- **계산된 부모 크기**: 실제 DOM 크기 반영 (250x140)
- **새 노드 X 위치**: 부모X + 250 + 30
- **새 노드 Y 위치**: 부모 중앙 기준 계산

### 실제 결과
- [ ] 통과 / [ ] 실패
- 측정된 크기: ___x___
- 실제 위치: X=___, Y=___
- 비고: ___________

---

## TC-POS-005: Edge Case - DOM 요소를 찾을 수 없는 경우

### 전제 조건
- 새로 생성된 노드 (DOM 렌더링 전)
- 해당 노드에서 즉시 자식 노드 생성 시도

### 테스트 단계
1. TextNode 생성
2. 즉시 해당 노드의 핸들 클릭 (DOM 렌더링 전)
3. 기본값 사용 여부 확인

### 예상 결과
- **기본 크기 사용**: 200x120
- **정상적인 위치 계산**: 기본값 기반으로 계산
- **오류 없음**: 에러 발생하지 않음

### 실제 결과
- [ ] 통과 / [ ] 실패
- 사용된 크기: ___x___
- 비고: ___________

---

## 🔍 테스트 실행 방법

### 수동 테스트
1. 브라우저에서 애플리케이션 실행
2. 개발자 도구 Console 탭 열기
3. 각 TC 단계별로 실행하며 결과 기록
4. 위치 확인: React Flow 노드의 `data-id` 속성으로 DOM 요소 확인

### 자동화 가능 영역
```javascript
// 콘솔에서 위치 확인 헬퍼 함수
function checkNodePosition(nodeKey) {
  const element = document.querySelector(`[data-id="${nodeKey}"]`);
  if (element) {
    const rect = element.getBoundingClientRect();
    console.log(`Node ${nodeKey}: x=${rect.left}, y=${rect.top}, w=${rect.width}, h=${rect.height}`);
    return { x: rect.left, y: rect.top, width: rect.width, height: rect.height };
  }
  return null;
}
```

---

## 📊 테스트 결과 요약

| TC ID | 테스트 케이스 | 상태 | 비고 |
|-------|--------------|------|------|
| TC-POS-001 | TextNode 단일 자식 | ⬜ | |
| TC-POS-002 | ChoiceNode 첫 자식 | ⬜ | |
| TC-POS-003 | ChoiceNode 다중 자식 | ⬜ | |
| TC-POS-004 | 동적 크기 대응 | ⬜ | |
| TC-POS-005 | Edge Case 처리 | ⬜ | |

**총 테스트**: 5개  
**통과**: ___개  
**실패**: ___개  
**통과율**: ___% 